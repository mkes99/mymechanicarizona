---
/**
 * ReviewsGrid
 * .astro
 * - Wraps Trust.Reviews embed snippet
 * - Loads embed.min.js only once
 *
 * Usage:
 *   <ReviewsGrid
 *  id="7916" />
 */

const {
  id = 7916,
  view = "list",
  lang = "",
  showPoweredBy = true
} = Astro.props;
---

<div
  class="tr-widget"
  data-id={String(id)}
  data-view={String(view)}
  data-lang={String(lang)}
>
  {showPoweredBy && (
    <a
      href="https://trust.reviews/"
      class="trcr"
      target="_blank"
      rel="noopener noreferrer"
    >
      Powered by <span>Trust.Reviews</span>
    </a>
  )}
</div>

<script is:inline>
(function () {
  try {
    var SRC = "https://cdn.trust.reviews/widget/embed.min.js";
    var STYLE_ID = "mm-hide-trust-reviews-branding";

    function injectHideStyle() {
      if (document.getElementById(STYLE_ID)) return;

      var style = document.createElement("style");
      style.id = STYLE_ID;
      style.type = "text/css";
      style.appendChild(
        document.createTextNode(
          "html body.page .rplg + a.trcr { display: none !important; }"
        )
      );
      document.head.appendChild(style);
    }

    function ensureScript() {
      var existing = document.querySelector('script[src="' + SRC + '"]');
      if (existing || window.__TRUST_REVIEWS_EMBED_LOADED__ === true) {
        injectHideStyle();
        return;
      }

      var s = document.createElement("script");
      s.src = SRC;
      s.type = "text/javascript";
      s.defer = true;
      s.onload = function () {
        window.__TRUST_REVIEWS_EMBED_LOADED__ = true;
        injectHideStyle();
      };
      document.head.appendChild(s);
    }

    ensureScript();

    // Re-assert a few times in case widget re-renders itself
    var tries = 0;
    var iv = setInterval(function () {
      injectHideStyle();
      tries++;
      if (tries > 10) clearInterval(iv);
    }, 500);
  } catch (e) {
    // fail silently
  }
})();
</script>